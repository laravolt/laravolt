<?php

use Illuminate\Support\Facades\Session;
use Laravolt\SemanticForm\Elements\FormOpen;

class FormOpenTest extends \PHPUnit\Framework\TestCase
{
    public function testRenderBasicFormOpen()
    {
        Session::shouldReceive('token')->once()->andReturn('abc123');

        $form = new FormOpen();
        $expected = '<form method="POST" action="" class="ui form"><input type="hidden" name="_token" value="abc123">';
        $result = $form->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderBasicFormOpenWithoutToken()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form">';
        $result = $form->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderBasicFormOpenWithAction()
    {
        $form = new FormOpen('/test');
        $form->withoutToken();
        $expected = '<form method="POST" action="/test" class="ui form">';
        $result = $form->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderPostFormOpen()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form">';
        $result = $form->post()->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderGetFormOpen()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="GET" action="" class="ui form">';
        $result = $form->get()->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderPutFormOpen()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form"><input type="hidden" name="_method" value="PUT">';
        $result = $form->put()->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderPatchFormOpen()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form"><input type="hidden" name="_method" value="PATCH">';
        $result = $form->patch()->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderDeleteFormOpen()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form"><input type="hidden" name="_method" value="DELETE">';
        $result = $form->delete()->render();

        $this->assertEquals($expected, $result);
    }

    public function testSetAction()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="/test" class="ui form">';
        $result = $form->action('/test')->render();

        $this->assertEquals($expected, $result);
    }

    public function testSetRoute()
    {
        \Illuminate\Support\Facades\URL::shouldReceive('route')->once()->andReturn('/test');

        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="/test" class="ui form">';
        $result = $form->route('test.store')->render();

        $this->assertEquals($expected, $result);
    }

    public function testSetRouteWithParameter()
    {
        \Illuminate\Support\Facades\URL::shouldReceive('route')
            ->with('test.update', ['id' => 1], true)
            ->once()
            ->andReturn('/test/1');

        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="/test/1" class="ui form">';
        $result = $form->route('test.update', ['id' => 1])->render();

        $this->assertEquals($expected, $result);
    }

    public function testSetUrl()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="/test" class="ui form">';
        $result = $form->url('/test')->render();

        $this->assertEquals($expected, $result);
    }

    public function testSetCustomAttribute()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form" data-test="sample">';
        $result = $form->attribute('data-test', 'sample')->render();

        $this->assertEquals($expected, $result);
    }

    public function testClearCustomAttribute()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form">';
        $result = $form->attribute('data-test', 'sample')->clear('data-test')->render();

        $this->assertEquals($expected, $result);
    }

    public function testMultipart()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form" enctype="multipart/form-data">';
        $result = $form->multipart()->render();

        $this->assertEquals($expected, $result);
    }

    public function testEncodingType()
    {
        $form = new FormOpen();
        $form->withoutToken();
        $expected = '<form method="POST" action="" class="ui form" enctype="custom">';
        $result = $form->encodingType('custom')->render();

        $this->assertEquals($expected, $result);
    }

    public function testCanRenderCsrfToken()
    {
        Session::shouldReceive('token')->once()->andReturn('1');

        $form = new FormOpen();
        $expected = '<form method="POST" action="" class="ui form"><input type="hidden" name="_token" value="1">';
        $result = (string) $form;

        $this->assertEquals($expected, $result);
    }

    public function testRenderCustomMethodWithToken()
    {
        Session::shouldReceive('token')->once()->andReturn('2');

        $form = new FormOpen();
        $expected = '<form method="POST" action="" class="ui form"><input type="hidden" name="_token" value="2"><input type="hidden" name="_method" value="DELETE">';
        $result = $form->delete()->render();

        $this->assertEquals($expected, $result);
    }

    public function testRenderGetWithToken()
    {
        $form = new FormOpen();
        $expected = '<form method="GET" action="" class="ui form">';
        $result = $form->get()->render();

        $this->assertEquals($expected, $result);
    }

    public function testHorizontalForm()
    {
        $form = new FormOpen();
        $expected = '<form method="GET" action="" class="ui form horizontal">';
        $result = $form->horizontal()->get()->render();

        $this->assertEquals($expected, $result);
    }

    protected function tearDown(): void
    {
        Mockery::close();
    }
}
